#!/bin/bash
# messaging_app/kurbeScript

set -euo pipefail

echo "ğŸ” Checking system dependencies..."

# Function to check if a command exists
command_exists() {
  command -v "$1" >/dev/null 2>&1
}

# ğŸ§° Install kubectl if not found
install_kubectl() {
  echo "ğŸ“¦ Installing kubectl..."
  curl -LO "https://dl.k8s.io/release/$(curl -sL https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
  chmod +x kubectl
  sudo mv kubectl /usr/local/bin/
  echo "âœ… kubectl installed."
}

# ğŸ§° Install minikube if not found
install_minikube() {
  echo "ğŸ“¦ Installing Minikube..."
  curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
  chmod +x minikube-linux-amd64
  sudo mv minikube-linux-amd64 /usr/local/bin/minikube
  echo "âœ… Minikube installed."
}

# ğŸ“ Ensure kubectl
if ! command_exists kubectl; then
  echo "âŒ kubectl not found."
  install_kubectl
else
  echo "âœ… kubectl is installed."
fi

# ğŸ“ Ensure minikube
if ! command_exists minikube; then
  echo "âŒ Minikube not found."
  install_minikube
else
  echo "âœ… Minikube is installed."
fi

# ğŸš€ Start minikube
echo "ğŸš€ Starting Minikube cluster..."
minikube start --driver=docker

echo "â³ Waiting for the cluster to be ready..."
sleep 10

# ğŸ§  Check cluster info
echo "ğŸ” Verifying cluster status..."
kubectl cluster-info

# ğŸ“¦ List all pods
echo "ğŸ“¦ Listing current pods in all namespaces..."
kubectl get pods --all-namespaces

echo "ğŸ‰ Kubernetes cluster is running and operational."
